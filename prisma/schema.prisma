generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User role enum
enum Role {
  USER
  ADMIN
}

// User model for authentication and core data
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String // Hashed password
  name          String?
  role          Role      @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  profile       Profile?
  sentProposals Proposal[] @relation("SentProposals")
  receivedProposals Proposal[] @relation("ReceivedProposals")
  
  // Matching and Social
  sentMatches     Match[] @relation("Sender")
  receivedMatches Match[] @relation("Receiver")
  
  // Chat
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")

  @@map("users")
}

// Detailed User Profile for Discovery
model Profile {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Vital Stats
  dateOfBirth   DateTime?
  age           Int
  gender        String
  bio           String
  location      String
  
  // Filters defined by user
  jobStatus     String    // e.g., "EMPLOYED", "UNEMPLOYED", "STUDENT"
  maritalStatus String    // e.g., "SINGLE", "WIDOWED", "DIVORCED"
  
  jobCategory   String   // New field for specific job category
  contactDetails String  // New field for user contact info
  
  // Media
  photoUrl      String
  coverUrl      String?   // New field for cover photo
  photoGallery  String?   // New field for multiple photos (comma-separated)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("profiles")
}

// Match connection between two users
model Match {
  id            String    @id @default(uuid())
  senderId      String
  receiverId    String
  status        String    @default("PENDING") // PENDING, ACCEPTED, REJECTED
  
  sender        User      @relation("Sender", fields: [senderId], references: [id])
  receiver      User      @relation("Receiver", fields: [receiverId], references: [id])
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([senderId, receiverId])
  @@map("matches")
}

// Real-time Chat Messages
model Message {
  id            String    @id @default(uuid())
  content       String
  senderId      String
  receiverId    String
  
  sender        User      @relation("SentMessages", fields: [senderId], references: [id])
  receiver      User      @relation("ReceivedMessages", fields: [receiverId], references: [id])
  
  read          Boolean   @default(false)
  createdAt     DateTime  @default(now())

  @@map("messages")
}

// Updated Proposal Model
model Proposal {
  id            String    @id @default(uuid())
  
  // Link to registered users
  proposerId    String
  recipientId   String
  
  proposer      User      @relation("SentProposals", fields: [proposerId], references: [id])
  recipient     User      @relation("ReceivedProposals", fields: [recipientId], references: [id])
  
  answer        String    @default("PENDING") // YES, NO, PENDING
  message       String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("proposals")
}
